# 概论
统筹、协调和管理计算机系统中各类资源
- 基本特征：**并发**、**共享**、异步、虚拟
- 历史
  - 批处理系统：按照一定顺序，逐一执行事先编组好的成批计算任务
  - 分时系统：同时装入多个任务，每个任务分配一定的时间和空间运行
  - 实时操作系统
- 指令：特权指令（不允许操作系统使用，仅允许操作系统使用）、非特权指令
- 处理机状态（处理器特权级，硬件实现）：
    - 用户态（目态）：CPU仅执行非特权指令（应用程序）
    - 核心态（管态）：可执行所有指令（内核程序）
用户态转换核心态：中断，**硬件**完成

原则：	操作系统的最高设计目标，通常由操作系统所在的领域的需求决定。
设计：	操作系统的高层次抽象描述，描述各个组件的抽象功能。
实现：	操作系统的低层次具体描述，描述各个组件的具体实施。
策略：	操作系统中对资源进行管理的方法和政策。
机制：	操作系统为实现策略使用的工具和手段。

# 程序的结构
线程：
- 按照操作系统中的线程的优先级，大致可以将它们分为如下五类
输入输出线程
系统服务线程（一系列为应用程序提供必要服务的线程。这些线程承担着重要的职责，因而一般位于较高优先级段）
前台程序线程（当前用户正在交互的应用程序中的线程）
后台服务线程（提供一些时间不敏感的背景服务的线程）
CPU空闲线程（反复将当前处理器置于睡眠态以节约功耗）
- 按来源划分
驱动程序线程（驱动程序线程的运行交给操作系统管理，用户不能直接管理。）
系统内核线程（完成操作系统功能所必备的线程，对用户透明）
应用程序线程（一般的应用程序的线程）
- 按特权划分：内核线程、用户线程



# 时间协调(线程)
- 处理器
  - 指令流：一个应用程序内部可以由一个或多个逻辑上互相独立执行的指令序列组成
  一个指令流往往由两部分组成，一部分负责计算，另一部分负责I/O
  - 指令流间的执行顺序
    - 顺序执行
    - 合作执行\
    将每个指令流打断成多份，每一份之内都顺序执行，但背靠背执行的两份不一定来自同一个指令流。在每份指令流的末尾，都通知操作系统主动放弃CPU，CPU将转去执行下一份指令流。
  - 指令流的三个基本状态
  运行、就绪、阻塞
  - 线程：CPU时间分配的基本对象，指令流通过依附于线程，获得了在CPU上运行的权利
    - 线程的上下文：寄存器组
    - 线程控制块：时间预算、优先级、运行状态及上下文，线程控制块位于内核空间
  - 公平：体现在该式包含了对所有任务的考虑
    - 吞吐率：单位时间内执行完的线程的个数\
    时间T内，有N个线程完成执行，就说它的吞吐率为N/T
    - 平均等待时间：线程从就绪态到**运行态**平均等待的时间\
    (W1+W2+...+Wn)/N。
    - 平均周转时间：线程从就绪态到**阻塞或停止态**平均花费的时间
    (T1+T2+...+Tn)/N。
		若设线程的运行时间为Ri，则Ti=Wi+Ri。
  - 正义：体现在该式对越短任务的越长等待越不容忍
    - 平均带权周转时间，其计算式为(T1/R1+T2/R2+...+Tn/Rn)/N。T/R又叫响应比，T/R=1+(W/R)

  - 调度算法：

    1. 固定优先级，FP，时间预算无限长
    2. 先来先服务，FCFS，(公平的极端)
    3. 短作业优先，SJF，饥饿，(正义的极端)
    4. 时间片轮转法，RR
      - 固定优先级时间片轮转法，FPRR\
      同一个优先级的任务采取时间片轮转法，不同优先级的任务之间则采取严格的抢占式固定优先级	调度
    5. 在线算法On-Line Algorithm


# 空间协调(进程)
- 程序的虚拟地址布局\
程序在执行时的虚拟地址布局是分段的：代码段、数据段、堆段栈段
- 内存隔离机制
  - 分段，程序的逻辑组织基本单元是段，每个程序的虚拟段到物理段的映射关系组成段表
  - 分页，物理地址切割成大小相等的小页，每个程序的虚拟页到物理页的映射关系组成页表\
  外部碎片在页式管理中不存在，因为物理内存不存在必须连续才能分配的要求
  - 页的本质就是大小相等的小段
- 段表查询：快表TLB，缓存当前工作集常用的段描述符
- 分配堆中内存：一个好的在线算法拥有较低的竞争比
- 内存替换算法
  - 最长前向距离算法，LFD\
  寻找当前页面中在最远的未来才会再次使用的页面替换
  - 先进先出，FIFO
  - 最久未用，LRU
  - 碎片：
出于某些原因，无法有效利用而被浪费掉的资源。
内部碎片（已经指派给某个分配无法使用）、外部碎片（尚未指派无法使用）
  1. 固定块法，内部碎片多
  2. 多固定块法，外部碎片多
  3. 动态分区法：将整个堆切成与某个粒度相同的小块，粒度由所有分配的最大	公约数决定，无法避免外部碎片
  4. 首次适配法（First-Fit）：线性检索，第一个能容纳该分配的空闲区被选中，无法避免碎片
  5. 最好适配法（Best-Fit）：遍历空闲区列表，选择能容纳该分配的空闲区中的最小的那个，让小的空闲区碎的更厉害
- 进程：操作系统提供给应用程序的一种对地址空间的抽象机制。\
  - 内存分配的基本对象。操作系统通过给进程分配内存，来给依附在这个进程上的应用程序提供运行空间。
程序通过依附于进程，获得了占用内存空间的权利。
  - 进程的描述\
  描述符表:进程本身是一个地址空间，这个表格描述哪些内存该进程有权访问，以及怎么访问。
  - 进程控制块：进程名、进程号、线程数、线程列表、地址空间描述符表、统计信息
  - 进程与线程：\
  线程通过在进程里运行，将CPU时间转化为对地址空间的一个访问操作次序，从而实现应用程序的功能。
  进程仅仅是一个执行空间，本身不具备执行能力，运行的是它里面的线程上的指令流。单指令流依附于单线程，单线程运行于单进程最为常见。

# 交互协调(I/O管理)
# 关系协调
1. 互斥与同步
死锁: 系统中有指令流发生无法自行解除的循环等待
死锁的四个必要条件：
1、互斥条件：一个资源每次只能被一个进程使用；

2、请求与保持条件：一个进程因请求资源而阻塞时，对已获得的资源保持不放；

3、不剥夺条件:进程已获得的资源，在末使用完之前，不能强行剥夺；

4、循环等待条件:若干进程之间形成一种头尾相接的循环等待资源关系；



# 简答
> 简述批处理操作系统的优点和缺点

批处理系统是指系统对作业的处理都是成批进行的。
优点：资源利用率高,系统吞吐量大
缺点；平均周转时间长,无交互能力，无法编辑更改，需要重新编写
> 设计/实现、策略/机制的区别

设计是高层次的抽象，实现是低层次的实施；策略是设计工作的方式，机制是达到目标的具体方法。
> 指令的一般分类五种
 
1、数据传送
2、算术运算
3、位操作（逻辑操作）
4、控制转移（跳转）
5、处理机控制
（6、字符串操作）

> 相比8086，amd64硬件中断相应为什么要额外压栈用户态ss和rsp

8086没有特权态，amd64的硬件中断程序运行内核态，使用内核态堆栈，若不压入用户态ss和rsp则在中断返回时会出现错误。

> 直接回填法和间接地址法的优劣

直接回填法
优：性能好
劣：灵活性差
间接地址法
优：灵活性强
劣：性能差

> 简述在共享动态链接库设计中需要使用位置无关代码的原因
 
在动态链接库被多个程序加载时，该库中的代码段可能被加载到不同的内存地址上，此时相对地址可能出错，此时就需要位置无关代码，使动态链接库在任何地址空间下都能正确执行。

> 指令流与线程多对多对应设计的优缺点

优点：给指令流提供多余一个上下文，任何一个不阻塞的线程都可以运行任何一个不阻塞的指令流，指令流可以在线程之间迁移。
缺点：复杂，难以实现